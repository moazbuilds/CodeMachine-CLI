<step n="6" goal="Write directive to control workflow">
  <critical>CRITICAL: You must write a directive based on what happened during review</critical>

  <!-- First: Get next story info -->
  <action>Load {sprint_status} and find stories NOT in "done" status</action>
  <action>Set {{remaining_stories}} = list of story keys with status != "done"</action>
  <action>Set {{next_story_key}} = first story in remaining_stories (excluding current {{story_key}})</action>

  <!-- PAUSE: If anything unexpected happened (no story to review, errors, edge cases) -->
  <check if="no story was in review status OR could not find story OR any unexpected situation">
    <action>Write to `.codemachine/memory/directive.json`:
    ```json
    {
      "action": "pause",
      "reason": "No story in review status or unexpected situation - user input required"
    }
    ```
    </action>
    <output>**PAUSED**: Could not proceed normally. Please check and provide direction.</output>
  </check>

  <!-- LOOP: Story reviewed successfully, continue to next -->
  <check if="story was reviewed successfully">
    <action>Write to `.codemachine/memory/directive.json`:
    ```json
    {
      "action": "loop",
      "reason": "{{story_key}} done, next: {{next_story_key}}"
    }
    ```
    </action>
    <output>Review complete - looping to next story.</output>
  </check>
</step>
